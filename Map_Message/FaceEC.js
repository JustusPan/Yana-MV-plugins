//
//  フェイス設定制御文字 ver1.02
//
// ------------------------------------------------------
// Copyright (c) 2016 Yana
// Released under the MIT license
// http://opensource.org/licenses/mit-license.php
// ------------------------------------------------------
//
// author Yana
//

var Imported = Imported || {};
Imported['FaceEC'] = 1.02;

/*:
 * @plugindesc ver1.02/フェイスを設定する制御文字を追加します。
 * @author Yana
 *
 * @param SetFace1
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace2
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace3
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace4
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace5
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace6
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace7
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace8
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace9
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace10
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace11
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace12
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace13
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace14
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace15
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace16
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace17
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace18
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace19
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace20
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace21
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace22
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace23
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace24
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace25
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace26
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace27
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace28
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace29
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace30
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace31
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace32
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace33
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace34
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace35
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace36
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace37
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace38
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace39
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace40
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace41
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace42
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace43
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace44
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace45
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace46
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace47
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace48
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace49
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @param SetFace50
 * @desc 呼び出すフェイスのファイル名です。
 * @default
 * @require 1
 * @dir img/faces/
 * @type file
 *
 * @help ------------------------------------------------------
 * 設定方法
 * ------------------------------------------------------
 * イベントコマンド「文章の表示」の1行目で
 * _af[x+y]
 * または、
 * _sf[x+y]
 * と記述します。
 *
 * _afの場合は、x番のアクターのフェイスのインデックスにyを加算した
 * フェイスを設定します。
 *
 * _sfの場合は、プラグインパラメータで設定したID、x番のフェイス画像
 * のインデックスy番のフェイスを設定します。
 *
 * ------------------------------------------------------
 * 利用規約
 * ------------------------------------------------------
 * 当プラグインはMITライセンスで公開されています。
 * 使用に制限はありません。商用、アダルト、いずれにも使用できます。
 * 二次配布も制限はしませんが、サポートは行いません。
 * 著作表示は任意です。行わなくても利用できます。
 * 要するに、特に規約はありません。
 * バグ報告や使用方法等のお問合せはネ実ツクールスレ、または、Twitterにお願いします。
 * https://twitter.com/yanatsuki_
 * 素材利用は自己責任でお願いします。
 * ------------------------------------------------------
 * 更新履歴:
 * ver1.02:
 * 制御文字拡張との併用化処理を追加。
 * ver1.01:
 * \V[x]の制御文字を使用できるように変更。
 * ver1.00:
 * 公開
 */
(function() {
    ////////////////////////////////////////////////////////////////////////////////////

    var parameters = PluginManager.parameters('FaceEC');

    ////////////////////////////////////////////////////////////////////////////////////

    Game_Temp.prototype.setFace = function (index){
        if (this._setFace){ return this._setFace[index] }
        this._setFace = [];
        for (var i=1;i<51;i++){ this._setFace[i] = parameters['SetFace' + i] }
        return this._setFace[index]
    };
    
    ////////////////////////////////////////////////////////////////////////////////////

    var __GInterpreter_command101 = Game_Interpreter.prototype.command101;
    Game_Interpreter.prototype.command101 = function() {
        if (!$gameMessage.isBusy()) {
            var index = this._index + 1;
            var nextParam = this._list[index];
            var text = nextParam.parameters[0];
            var text2 = text.replace(/\\v\[(\d+)\]/gi,function(){ return $gameVariables.value(Number(arguments[1]))});
            this._list[index].parameters[0] = text2.replace(/_([asAS])[fF]\[(\d+)[+-]?([+-]\d+)?\]/,function(){
                var isActor = arguments[1].search(/[Aa]/) >= 0;
                var faceId = Number(arguments[2]);
                var faceIndex = Number(arguments[3]) || 0;
                this._params[0] = isActor ? $dataActors[faceId].faceName : $gameTemp.setFace(faceId-1);
                this._params[1] = isActor ? $dataActors[faceId].faceIndex + faceIndex : faceIndex;
                return '';
            }.bind(this));
            var result = __GInterpreter_command101.call(this);
            this._list[index].parameters[0] = text;
            return result;
        } else {
            return false;
        }
    };

    ////////////////////////////////////////////////////////////////////////////////////
}());